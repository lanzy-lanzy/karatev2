{% extends "base.html" %}

{% block title %}{% if trainee %}Edit{% else %}Add{% endif %} Trainee - BlackCobra Karate Club{% endblock %}

{% block page_title %}{% if trainee %}Edit Trainee{% else %}Add New Trainee{% endif %}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Back Link -->
    <div class="mb-6">
        <a href="{% url 'admin_trainees' %}"
            class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700 transition-colors">
            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Trainees
        </a>
    </div>

    <!-- Form Card -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">
                {% if trainee %}Edit Trainee Information{% else %}New Trainee Registration{% endif %}
            </h3>
            <p class="text-sm text-gray-500 mt-1">
                {% if trainee %}Update the trainee's details below.{% else %}Fill in the details to register a new
                trainee.{% endif %}
            </p>
        </div>

        <form method="post" enctype="multipart/form-data" class="p-6 space-y-6"
            hx-post="{% if trainee %}{% url 'admin_trainee_edit' trainee.id %}{% else %}{% url 'admin_trainee_add' %}{% endif %}"
            hx-target="body" hx-swap="innerHTML">
            {% csrf_token %}

            {% if form.non_field_errors %}
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex">
                    <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="ml-3">
                        {% for error in form.non_field_errors %}
                        <p class="text-sm text-red-700">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Personal Information Section -->
            <div>
                <h4 class="text-sm font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200">Personal Information
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Name -->
                    <div>
                        <label for="id_first_name" class="block text-sm font-medium text-gray-700 mb-2">
                            First Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="first_name" id="id_first_name"
                            value="{{ form.first_name.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.first_name.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.first_name.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label for="id_last_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Last Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="last_name" id="id_last_name"
                            value="{{ form.last_name.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.last_name.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.last_name.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div>
                        <label for="id_email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email <span class="text-red-500">*</span>
                        </label>
                        <input type="email" name="email" id="id_email" value="{{ form.email.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.email.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.email.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Date of Birth -->
                    <div>
                        <label for="id_date_of_birth" class="block text-sm font-medium text-gray-700 mb-2">
                            Date of Birth <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="date_of_birth" id="id_date_of_birth"
                            value="{{ form.date_of_birth.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.date_of_birth.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.date_of_birth.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.date_of_birth.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Phone -->
                    <div>
                        <label for="id_phone" class="block text-sm font-medium text-gray-700 mb-2">
                            Phone
                        </label>
                        <input type="tel" name="phone" id="id_phone" value="{{ form.phone.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.phone.errors %}border-red-500{% endif %}">
                        {% if form.phone.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Address -->
                    <div>
                        <label for="id_address" class="block text-sm font-medium text-gray-700 mb-2">
                            Address
                        </label>
                        <input type="text" name="address" id="id_address" value="{{ form.address.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.address.errors %}border-red-500{% endif %}">
                        {% if form.address.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.address.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Training Information Section -->
            <div>
                <h4 class="text-sm font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200">Training Information
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Belt Rank -->
                    <div>
                        <label for="id_belt_rank" class="block text-sm font-medium text-gray-700 mb-2">
                            Belt Rank <span class="text-red-500">*</span>
                        </label>
                        <select name="belt_rank" id="id_belt_rank"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.belt_rank.errors %}border-red-500{% endif %}"
                            required>
                            <option value="">Select Belt Rank</option>
                            <option value="white" {% if form.belt_rank.value == 'white' %}selected{% endif %}>White</option>
                            <option value="green" {% if form.belt_rank.value == 'green' %}selected{% endif %}>Green</option>
                            <option value="brown" {% if form.belt_rank.value == 'brown' %}selected{% endif %}>Brown</option>
                            <option value="black" {% if form.belt_rank.value == 'black' %}selected{% endif %}>Black</option>
                            <option value="master_degree" {% if form.belt_rank.value == 'master_degree' %}selected{% endif %}>Master Degree</option>
                        </select>
                        {% if form.belt_rank.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.belt_rank.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Weight -->
                    <div>
                        <label for="id_weight" class="block text-sm font-medium text-gray-700 mb-2">
                            Weight (kg) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" name="weight" id="id_weight" step="0.01" min="20" max="200"
                            value="{{ form.weight.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.weight.errors %}border-red-500{% endif %}"
                            required>
                        <p class="mt-1 text-sm text-gray-500">Weight class will be calculated automatically</p>
                        {% if form.weight.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.weight.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Status -->
                    <div>
                        <label for="id_status" class="block text-sm font-medium text-gray-700 mb-2">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select name="status" id="id_status"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.status.errors %}border-red-500{% endif %}"
                            required>
                            <option value="active" {% if form.status.value == 'active' or not form.status.value %}selected{% endif %}>Active</option>
                            <option value="inactive" {% if form.status.value == 'inactive' %}selected{% endif %}>Inactive</option>
                            <option value="suspended" {% if form.status.value == 'suspended' %}selected{% endif %}>Suspended</option>
                        </select>
                        {% if form.status.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.status.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Emergency Contact Section -->
            <div>
                <h4 class="text-sm font-medium text-gray-900 mb-4 pb-2 border-b border-gray-200">Emergency Contact</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Emergency Contact Name -->
                    <div>
                        <label for="id_emergency_contact" class="block text-sm font-medium text-gray-700 mb-2">
                            Contact Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="emergency_contact" id="id_emergency_contact"
                            value="{{ form.emergency_contact.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.emergency_contact.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.emergency_contact.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.emergency_contact.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Emergency Phone -->
                    <div>
                        <label for="id_emergency_phone" class="block text-sm font-medium text-gray-700 mb-2">
                            Contact Phone <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" name="emergency_phone" id="id_emergency_phone"
                            value="{{ form.emergency_phone.value|default:'' }}"
                            class="w-full px-4 py-3 min-h-[44px] border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors {% if form.emergency_phone.errors %}border-red-500{% endif %}"
                            required>
                        {% if form.emergency_phone.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.emergency_phone.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="{% url 'admin_trainees' %}"
                    class="px-6 py-3 min-h-[44px] text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors inline-flex items-center justify-center">
                    Cancel
                </a>
                <button type="submit"
                    class="px-6 py-3 min-h-[44px] text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center justify-center">
                    <span class="htmx-indicator mr-2">
                        <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                    </span>
                    {% if trainee %}Update Trainee{% else %}Add Trainee{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}